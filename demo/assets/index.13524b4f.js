import{o as T,c as P,a as r,t as y,u as a,b as w,r as q,d as B,e as b,f as M,w as p,g as o,h as G,p as J,i as Q,j as Y,s as ee,k as I,l as D,m as W,n as z,q as te,v as le,x as k,y as ie,F as se,z as ne,A as ae}from"./vendor.8891ea9d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerpolicy&&(n.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?n.credentials="include":i.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function t(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();const de="image-process",oe="4.3.2",re="A Image clipping or scaling, support local or same domain video file screenshot. It's implemented in canvas.",ce="dist/image-process.umd.js",he="dist/image-process.es.js",ue="types",me={".":{import:"./dist/image-process.es.js",require:"./dist/image-process.umd.js",types:"./types/index.d.ts"}},ge=["image","crop","Video screenshot","Image Compression","html5","canvas"],pe=["dist","types","packages/core"],_e="pnpm@7.5.1",fe={dev:"cd packages/demo && pnpm run dev","build:demo":"cd packages/demo && pnpm run build",build:"cd packages/core && pnpm run build",docs:"cd packages/core && pnpm run docs",lint:"eslint . --fix --ext .js,.cjs,.ts"},we={"@types/node":"^17.0.42","@typescript-eslint/eslint-plugin":"^5.27.1","@typescript-eslint/parser":"^5.27.1",eslint:"^8.17.0","eslint-config-prettier":"^8.5.0","eslint-import-resolver-typescript":"^2.7.1","eslint-plugin-import":"^2.26.0","eslint-plugin-prettier":"^4.0.0",inquirer:"^8.2.4",pnpm:"^7.5.1",prettier:"^2.6.2",typescript:"^4.7.3",vite:"^3.1.2"},ye="https://github.com/capricorncd/image-process-tools",xe="Xing Zhong <capricorncd@qq.com, zx198401@gmail.com>",be="MIT",ve={"zx-sml":"^0.7.6"},Ve={name:de,version:oe,description:re,main:ce,module:he,types:ue,exports:me,keywords:ge,files:pe,packageManager:_e,scripts:fe,devDependencies:we,repository:ye,author:xe,license:be,dependencies:ve};const Te=w(" image-process "),Re=r("a",{href:"https://github.com/capricorncd/image-process-tools",target:"_blank"},[r("svg",{height:"24",class:"octicon octicon-mark-github",viewBox:"0 0 16 16",version:"1.1",width:"24","aria-hidden":"true"},[r("path",{"fill-rule":"evenodd",fill:"currentColor",d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})])],-1),Pe={__name:"HeaderWrapper",setup(l){return(e,s)=>(T(),P("header",null,[r("h1",null,[Te,r("span",null,"v "+y(a(Ve).version),1)]),Re]))}},E={mimeType:"image/jpeg",perResize:500,quality:.9,width:0,height:0,longEdge:1e3,enableDevicePixelRatio:!1,isForce:!1,cropInfo:{sx:0,sy:0,sw:0,sh:0},currentTime:0},c=q({form:{...E,cropInfo:{...E.cropInfo}},result:null,file:null,setValue(l,e){this[l]=e}}),x=l=>(J("data-v-80c6a67d"),l=l(),Q(),l),Ee=x(()=>r("label",{for:"fileInput",class:"el-button el-button--danger is-round"},"Choose File",-1)),$e={class:"file-name"},De={class:"img-wrapper"},ze={key:0,class:"info"},Ce=x(()=>r("dt",null,"Current",-1)),Fe=x(()=>r("span",null,"width: ",-1)),ke=x(()=>r("span",null,"height: ",-1)),Ue=x(()=>r("span",null,"size: ",-1)),Oe=x(()=>r("span",null,"type: ",-1)),qe=x(()=>r("dt",null,"Raw",-1)),Be=x(()=>r("span",null,"width: ",-1)),Me=x(()=>r("span",null,"height: ",-1)),Ie=x(()=>r("span",null,"size: ",-1)),We=x(()=>r("span",null,"type: ",-1)),Ae=["src"],Le=B({__name:"MainWrapper",setup(l){const e=s=>{var n;const i=(n=s.target.files)==null?void 0:n[0];c.setValue("file",i)};return(s,t)=>{const i=b("el-form-item"),n=b("el-main");return T(),M(n,null,{default:p(()=>{var d;return[o(i,null,{default:p(()=>{var h;return[Ee,r("input",{id:"fileInput",class:"file-input",type:"file",onChange:e},null,32),r("span",$e,y((h=a(c).file)==null?void 0:h.name),1)]}),_:1}),r("div",De,[a(c).result?(T(),P("dl",ze,[Ce,r("dd",null,[Fe,w(y(a(c).result.width),1)]),r("dd",null,[ke,w(y(a(c).result.height),1)]),r("dd",null,[Ue,w(y(a(c).result.size.text),1)]),r("dd",null,[Oe,w(y(a(c).result.type),1)]),qe,r("dd",null,[Be,w(y(a(c).result.raw.width),1)]),r("dd",null,[Me,w(y(a(c).result.raw.height),1)]),r("dd",null,[Ie,w(y(a(c).result.raw.size.text),1)]),r("dd",null,[We,w(y(a(c).result.raw.type),1)])])):G("",!0),r("img",{src:(d=a(c).result)==null?void 0:d.url,alt:""},null,8,Ae)])]}),_:1})}}});const A=(l,e)=>{const s=l.__vccOpts||l;for(const[t,i]of e)s[t]=i;return s},Ne=A(Le,[["__scopeId","data-v-80c6a67d"]]),L={enableDevicePixelRatio:!1,isForce:!1,mimeType:"image/jpeg",perResize:500,quality:.9,width:0,height:0,longEdge:0},Se=/^data:(.+?);base64/,He=/^image\/.+/;function N(l,e){return new Promise((s,t)=>{var n;const i={...L,...e,longEdge:(n=e==null?void 0:e.longEdge)!=null?n:e==null?void 0:e.longestSide};typeof l=="string"&&Se.test(l)?U(l,i,s,t):(l instanceof File||l instanceof Blob)&&He.test(l.type)?Y(l).then(d=>{U(d,i,s,t)}).catch(t):t(new Error(`Invalid file, ${l}`))})}function U(l,e,s,t){const{type:i}=ee(l),n=I(l,i),d=new Image;d.onload=()=>{const h={element:d,blob:n,data:l,url:D(n),width:d.naturalWidth||d.width,height:d.naturalHeight||d.height,type:i,size:W(n.size)};e.cropInfo&&e.cropInfo.sw&&e.cropInfo.sh?O(h,e,s,t,{...e.cropInfo,dx:0,dy:0,dw:e.cropInfo.sw,dh:e.cropInfo.sh}):e.width&&e.height?O(h,e,s,t,Ke(h,e)):e.width||e.height||e.longEdge?je(h,e,s,t):$({...h,raw:h},e,s)},d.onerror=t,d.src=l}function O(l,e,s,t,i){try{Object.prototype.hasOwnProperty.call(i,"enableDevicePixelRatio")||(i.enableDevicePixelRatio=e.enableDevicePixelRatio);const n=C(l.element,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:i.sx,sy:i.sy,sw:i.sw,sh:i.sh,dx:0,dy:0,dw:i.sw,dh:i.sh});!e.width&&!e.height?e.longEdge?i.sw>i.sh?(e.width=e.longEdge,e.height=i.sh*e.width/i.sw):(e.height=e.longEdge,e.width=i.sw*e.height/i.sh):(e.width=i.sw,e.height=i.sh):e.width?e.height=i.sh*e.width/i.sw:e.width=i.sw*e.height/i.sh,S(n,l,e,{...i,sx:0,sy:0,sw:n.width,sh:n.height},s)}catch(n){t(n)}}function je(l,e,s,t){try{e.longEdge&&!e.width&&!e.height&&(l.width>=l.height?e.width=e.longEdge:e.height=e.longEdge);const i={enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:l.width,sh:l.height,dx:0,dy:0,dw:e.width,dh:e.height};if(e.width){if(l.width<e.width&&!e.isForce){$({...l,raw:l},e,s);return}i.dh=l.height*e.width/l.width,e.height=i.dh}else{if(l.height<e.height&&!e.isForce){$({...l,raw:l},e,s);return}i.dw=l.width*e.height/l.height,e.width=i.dw}S(l.element,l,e,i,s)}catch(i){t(i)}}function $(l,e,s){l.type!==e.mimeType?(l.type=e.mimeType,H(l.element,l.raw,e,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:l.width,sh:l.height,dx:0,dy:0,dw:l.width,dh:l.height},s)):s(l)}function S(l,e,s,t,i){let n=e.width>e.height?e.width-t.dw:e.height-t.dh;if(n>s.perResize){const d=e.height/e.width;for(;n>s.perResize;)n-=s.perResize,t.sw=l.width,t.sh=l.height,t.dw=s.width+n,t.dh=t.dw*d,l=C(l,t)}t.sw=l.width,t.sh=l.height,t.dw=s.width,t.dh=s.height,H(l,e,s,t,i)}function H(l,e,s,t,i){const n=C(l,t),d=/^\w+\/\*$/.test(s.mimeType)||!s.mimeType?e.type:s.mimeType,h=n.toDataURL(d,s.quality),u=I(h,d);i({element:n,type:d,width:n.width,height:n.height,blob:u,data:h,url:D(u),size:W(u.size),raw:e})}function Ke(l,e){const{width:s,height:t}=l,{width:i,height:n}=e;let d;const h=t*i/n;if(s>h)d={sx:(s-h)/2,sy:0,sw:h,sh:t};else{const u=s*n/i;d={sx:0,sy:(t-u)/2,sw:s,sh:u}}return{...d,dx:0,dy:0,dw:i,dh:n}}function C(l,e){const s=e.enableDevicePixelRatio&&window.devicePixelRatio||1,t=z("canvas");t.width=e.dw*s,t.height=e.dh*s;const i=t.getContext("2d");return i.scale(s,s),i.drawImage(l,e.sx,e.sy,e.sw,e.sh,e.dx,e.dy,e.dw,e.dh),t}function Ze(l,e){return new Promise((s,t)=>{const i={...L,...e},n=D(l);let d=z("video",{src:n,autoplay:!0}),h=!1;d.onerror=t,d.oncanplay=()=>{if(h)return;h=!0;const u=d.duration,g=typeof i.currentTime>"u"?u*Math.random():te(i.currentTime),f={url:n,videoFile:l,videoWidth:d.videoWidth,videoHeight:d.videoHeight,duration:u,currentTime:Math.min(g,u)};Xe(d,f).then(_=>{!i.width&&!i.height&&(i.width=f.videoWidth,i.height=f.videoHeight),N(_,e).then(v=>{s({videoInfo:f,...v}),d=null}).catch(t)}).catch(t)}})}function Xe(l,{currentTime:e,videoWidth:s,videoHeight:t}){return new Promise(i=>{l.currentTime=e,l.pause();const n="image/jpeg",d=z("canvas"),h=d.getContext("2d");d.width=s,d.height=t,setTimeout(()=>{h.drawImage(l,0,0,d.width,d.height),i(d.toDataURL(n))},500)})}function Ge(l,e){return new Promise((s,t)=>{const i=l.type;/^(image|video)/.test(i)?RegExp.$1==="image"?N(l,e).then(s).catch(t):Ze(l,e).then(s).catch(t):t(new Error(`File type[${i}] not supported`))})}const Je=w(" OK "),Qe=w(" Reset "),Ye=w("image"),et=B({__name:"AsideWrapper",setup(l){le(()=>c.file,()=>{h()});const e=k(()=>{var u;return(u=c.result)!=null&&u.videoInfo?c.result.videoInfo.duration:0}),s=k(()=>{var v;const{width:u=0,height:g=0}=((v=c.result)==null?void 0:v.raw)||{},{sx:f,sy:_}=c.form.cropInfo;return{sx:u,sy:g,sw:u-f,sh:g-_}}),t=c.form,i=()=>{t.mimeType=`image/${d.mimeTypeValue.replace(/\s/g,"")}`,h()},n=()=>{Object.keys(E).forEach(u=>{t[u]=E[u]}),d.mimeTypeValue="jpeg",h()},d=q({mimeTypeValue:"jpeg"}),h=()=>{!c.file||Ge(c.file,t).then(u=>{console.log(u),c.setValue("result",u)}).catch(u=>{console.error(u)})};return(u,g)=>{const f=b("el-slider"),_=b("el-form-item"),v=b("el-button"),K=b("el-input"),F=b("el-switch"),Z=b("el-form"),X=b("el-aside");return T(),M(X,{width:"320px"},{default:p(()=>[o(Z,{model:a(t),"label-position":"top"},{default:p(()=>[o(_,{label:`width: ${a(t).width}`},{default:p(()=>{var m,V;return[o(f,{modelValue:a(t).width,"onUpdate:modelValue":g[0]||(g[0]=R=>a(t).width=R),max:((V=(m=a(c).result)==null?void 0:m.raw)==null?void 0:V.width)||2e3,step:1},null,8,["modelValue","max"])]}),_:1},8,["label"]),o(_,{label:`height: ${a(t).height}`},{default:p(()=>{var m,V;return[o(f,{modelValue:a(t).height,"onUpdate:modelValue":g[1]||(g[1]=R=>a(t).height=R),max:((V=(m=a(c).result)==null?void 0:m.raw)==null?void 0:V.height)||2e3,step:1},null,8,["modelValue","max"])]}),_:1},8,["label"]),o(_,{label:`longEdge: ${a(t).longEdge}`},{default:p(()=>[o(f,{modelValue:a(t).longEdge,"onUpdate:modelValue":g[2]||(g[2]=m=>a(t).longEdge=m),max:a(c).result?Math.max(a(c).result.raw.width,a(c).result.raw.height):2e3,step:1},null,8,["modelValue","max"])]),_:1},8,["label"]),o(_,{label:"cropInfo"},{default:p(()=>[(T(!0),P(se,null,ie(Object.keys(a(t).cropInfo),(m,V)=>(T(),P("div",{key:V,class:"crop-info-item"},[r("span",null,y(`${m}: ${a(t).cropInfo[m]}`),1),o(f,{modelValue:a(t).cropInfo[m],"onUpdate:modelValue":R=>a(t).cropInfo[m]=R,max:a(s)[m],step:1},null,8,["modelValue","onUpdate:modelValue","max"])]))),128))]),_:1}),o(_,{class:"button-wrapper"},{default:p(()=>[o(v,{type:"primary",onClick:i},{default:p(()=>[Je]),_:1}),o(v,{onClick:n},{default:p(()=>[Qe]),_:1})]),_:1}),o(_,{label:`Video currentTime: ${a(t).currentTime}`},{default:p(()=>[o(f,{modelValue:a(t).currentTime,"onUpdate:modelValue":g[3]||(g[3]=m=>a(t).currentTime=m),disabled:!a(e),max:a(e),step:.01},null,8,["modelValue","disabled","max","step"])]),_:1},8,["label"]),o(_,{label:"mimeType: Output picture mimeType"},{default:p(()=>[o(K,{modelValue:d.mimeTypeValue,"onUpdate:modelValue":g[4]||(g[4]=m=>d.mimeTypeValue=m)},{prepend:p(()=>[Ye]),_:1},8,["modelValue"])]),_:1}),o(_,{label:`quality: ${a(t).quality}`},{default:p(()=>[o(f,{modelValue:a(t).quality,"onUpdate:modelValue":g[5]||(g[5]=m=>a(t).quality=m),max:1,step:.01},null,8,["modelValue","step"])]),_:1},8,["label"]),o(_,{label:`perResize: ${a(t).perResize}`},{default:p(()=>[o(f,{modelValue:a(t).perResize,"onUpdate:modelValue":g[6]||(g[6]=m=>a(t).perResize=m),min:10,max:1e3,step:10},null,8,["modelValue"])]),_:1},8,["label"]),o(_,{label:`enableDevicePixelRatio: ${a(t).enableDevicePixelRatio}`},{default:p(()=>[o(F,{modelValue:a(t).enableDevicePixelRatio,"onUpdate:modelValue":g[7]||(g[7]=m=>a(t).enableDevicePixelRatio=m)},null,8,["modelValue"])]),_:1},8,["label"]),o(_,{label:`isForce: ${a(t).isForce}`},{default:p(()=>[o(F,{modelValue:a(t).isForce,"onUpdate:modelValue":g[8]||(g[8]=m=>a(t).isForce=m)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})}}});const tt=A(et,[["__scopeId","data-v-a8efcff4"]]),lt={__name:"App",setup(l){return(e,s)=>{const t=b("el-container");return T(),P("div",null,[o(Pe),o(t,null,{default:p(()=>[o(Ne),o(tt)]),_:1})])}}};const j=ne(lt);j.use(ae);j.mount("#app");
