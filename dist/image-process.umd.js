/*!
 * image-process version 4.3.0
 * Author: Xing Zhong <capricorncd@qq.com, zx198401@gmail.com>
 * Repository: https://github.com/capricorncd/image-process-tools
 * Released on: 2022-09-18 15:10:19 (GMT+0900)
 */
(function(g,w){typeof exports=="object"&&typeof module<"u"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(g=typeof globalThis<"u"?globalThis:g||self,w(g.imageProcess={}))})(this,function(g){"use strict";/*!
 * zx-sml version 0.6.0
 * Author: Xing Zhong<zx198401@gmail.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-09-09 21:21:26 (GMT+0900)
 */var w=Object.defineProperty,_=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,E=(t,e,i)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,B=(t,e)=>{for(var i in e||(e={}))V.call(e,i)&&E(t,i,e[i]);if(_)for(var i of _(e))Y.call(e,i)&&E(t,i,e[i]);return t};function Z(t){return Array.isArray(t)}function $(t){return t!==null&&!Z(t)&&typeof t=="object"}var q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(t,e){(function(i,r){t.exports=r()})(typeof self<"u"?self:q,function(){return(()=>{var i={949:(n,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.toTwoDigits=void 0,a.toTwoDigits=function(d){return d[1]?d:"0"+d}},607:(n,a,d)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.toTwoDigits=a.toDate=a.formatDate=void 0;var h=d(949);Object.defineProperty(a,"toTwoDigits",{enumerable:!0,get:function(){return h.toTwoDigits}});var l={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function v(u){if(u instanceof Date)return u;if(typeof u=="number")return new Date(u);if(typeof u=="string"){var s=u.trim();if(/^\d+$/.test(s)){var o=s.length;return o===8?new Date([s.substr(0,4),s.substr(4,2),s.substr(6,2)].join("/")):o===6?new Date([s.substr(0,4),s.substr(4,2),"01"].join("/")):o===4?new Date(s+"/01/01"):new Date(parseInt(u))}if(s=s.replace(/[年月日]/g,function(c){return c==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(s))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(s))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var f=new Date(s);return isNaN(f.getFullYear())?null:f}return null}a.formatDate=function(u,s,o){var f,c=v(u);if(!c||!s)return u+"";if(s==="timestamp")return c.getTime().toString();/(y+)/i.test(s)&&(f=RegExp.$1,s=s.replace(f,(c.getFullYear()+"").substr(4-f.length))),o&&Array.isArray(o.weeks)||(o=l);var N={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"w+":c.getDay(),"W+":o.weeks[c.getDay()],"a+":c.getHours()<12?"am":"pm","A+":c.getHours()<12?"AM":"PM"};for(var z in N)if(new RegExp("("+z+")").test(s)){f=RegExp.$1;var k=N[z]+"";s=s.replace(f,f.length===1?k:h.toTwoDigits(k))}if(/(g)/i.test(s)){var W=c.toString().split(/\s+/).slice(5),ne=s.includes("g");s=s.replace(/g/i,ne?W[0]:W.join(" "))}return s},a.toDate=v}},r={};return function n(a){if(r[a])return r[a].exports;var d=r[a]={exports:{}};return i[a](d,d.exports,n),d.exports}(607)})()})})(m);function p(t="",e="-"){return t.replace(/[A-Z]/g,(i,r)=>`${r>0?e:""}${i.toLowerCase()}`)}function G(t="",e=!1){const i=t.replace(/[-_\s](\w)/g,(r,n)=>n.toUpperCase());return e?i.replace(/^\w/,r=>r.toUpperCase()):i}function K(t){return t.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,e=>e.replace(/,/g,""))}function O(t,e=!1){if(typeof t=="number")return t;if(typeof t=="string"){if(!e&&/^(-?\d+(?:\.\d+)?)\D*/.test(K(t)))return O(RegExp.$1,!0);const i=Number(t);return isNaN(i)?0:i}return 0}function F(t={},e=!1){const i=e?G:p,r={};for(const[n,a]of Object.entries(t))r[i(n)]=$(a)?F(a,e):a;return r}function x(t,e=!1,i=2){const r=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],n=e?1e3:1024;let a=String(t),d="Byte";for(let h=0,l=t/n;l>1;l/=n,h++)a=l.toFixed(i),d=r[h];return e&&(d=d.replace("i","")),{text:a.replace(/\.0+$/,"")+d,value:+a,unit:d,bytes:t}}function y(t,e={},i){const r=document.createElement(t);for(const[n,a]of Object.entries(e))r.setAttribute(p(n),n==="style"&&$(a)?J(a):a);return i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{if(typeof n=="string"){const a=y("div");a.innerHTML=n,r.append(...a.childNodes)}else r.append(n)})),r}function J(...t){const e=t.reduce((r,n)=>B(B({},r),F(n)),{}),i=[];for(const[r,n]of Object.entries(e))n===""||typeof n>"u"||n===null||i.push(`${r}:${n}`);return i.join(";")}function M(t){return new Promise((e,i)=>{const r=new FileReader;r.onload=n=>{var a;const d=(a=n.target)==null?void 0:a.result;d?e(d):i(new Error(`FileReader's result is null, ${n.target}`))},r.onerror=i,r.readAsDataURL(t)})}function b(t){return(window.URL||window.webkitURL).createObjectURL(t)}function R(t){const e=t.split(",");let i="";return/data:(\w+\/\w+);base64/.test(e[0])&&(i=RegExp.$1),{type:i,data:e[1]}}function D(t,e){const i=R(t),r=window.atob(i.data);e=e||i.type;const n=new Uint8Array(r.length);for(let a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return new Blob([n],{type:e})}m.exports.formatDate,m.exports.toDate,m.exports.toTwoDigits;const U={enableDevicePixelRatio:!1,isForce:!1,mimeType:"image/jpeg",perResize:500,quality:.9,width:0,height:0,longestSide:0},Q=/^data:(.+?);base64/,X=/^image\/.+/;function T(t,e){return new Promise((i,r)=>{const n={...U,...e};typeof t=="string"&&Q.test(t)?A(t,n,i,r):(t instanceof File||t instanceof Blob)&&X.test(t.type)?M(t).then(a=>{A(a,n,i,r)}).catch(r):r(new Error(`Invalid file, ${t}`))})}function A(t,e,i,r){const{type:n}=R(t),a=D(t,n),d=new Image;d.onload=()=>{const h={element:d,blob:a,data:t,url:b(a),width:d.naturalWidth||d.width,height:d.naturalHeight||d.height,type:n,size:x(a.size)};e.cropInfo&&e.cropInfo.sw&&e.cropInfo.sh?L(h,e,i,r,{...e.cropInfo,dx:0,dy:0,dw:e.cropInfo.sw,dh:e.cropInfo.sh}):e.width&&e.height?L(h,e,i,r,ee(h,e)):e.width||e.height||e.longestSide?I(h,e,i,r):P({...h,raw:h},e,i)},d.onerror=r,d.src=t}function L(t,e,i,r,n){try{Object.prototype.hasOwnProperty.call(n,"enableDevicePixelRatio")||(n.enableDevicePixelRatio=e.enableDevicePixelRatio);const a=S(t.element,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:n.sx,sy:n.sy,sw:n.sw,sh:n.sh,dx:0,dy:0,dw:n.sw,dh:n.sh});!e.width&&!e.height?e.longestSide?n.sw>n.sh?(e.width=e.longestSide,e.height=n.sh*e.width/n.sw):(e.height=e.longestSide,e.width=n.sw*e.height/n.sh):(e.width=n.sw,e.height=n.sh):e.width?e.height=n.sh*e.width/n.sw:e.width=n.sw*e.height/n.sh,j(a,t,e,{...n,sx:0,sy:0,sw:a.width,sh:a.height},i)}catch(a){r(a)}}function I(t,e,i,r){try{e.longestSide&&!e.width&&!e.height&&(t.width>=t.height?e.width=e.longestSide:e.height=e.longestSide);const n={enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:t.width,sh:t.height,dx:0,dy:0,dw:e.width,dh:e.height};if(e.width){if(t.width<e.width&&!e.isForce){P({...t,raw:t},e,i);return}n.dh=t.height*e.width/t.width,e.height=n.dh}else{if(t.height<e.height&&!e.isForce){P({...t,raw:t},e,i);return}n.dw=t.width*e.height/t.height,e.width=n.dw}j(t.element,t,e,n,i)}catch(n){r(n)}}function P(t,e,i){t.type!==e.mimeType?(t.type=e.mimeType,C(t.element,t.raw,e,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:t.width,sh:t.height,dx:0,dy:0,dw:t.width,dh:t.height},i)):i(t)}function j(t,e,i,r,n){let a=e.width>e.height?e.width-r.dw:e.height-r.dh;if(a>i.perResize){const d=e.height/e.width;for(;a>i.perResize;)a-=i.perResize,r.sw=t.width,r.sh=t.height,r.dw=i.width+a,r.dh=r.dw*d,t=S(t,r)}r.sw=t.width,r.sh=t.height,r.dw=i.width,r.dh=i.height,C(t,e,i,r,n)}function C(t,e,i,r,n){const a=S(t,r),d=/^\w+\/\*$/.test(i.mimeType)||!i.mimeType?e.type:i.mimeType,h=a.toDataURL(d,i.quality),l=D(h,d);n({element:a,type:d,width:a.width,height:a.height,blob:l,data:h,url:b(l),size:x(l.size),raw:e})}function ee(t,e){const{width:i,height:r}=t,{width:n,height:a}=e;let d;const h=r*n/a;if(i>h)d={sx:(i-h)/2,sy:0,sw:h,sh:r};else{const l=i*a/n;d={sx:0,sy:(r-l)/2,sw:i,sh:l}}return{...d,dx:0,dy:0,dw:n,dh:a}}function S(t,e){const i=e.enableDevicePixelRatio&&window.devicePixelRatio||1,r=y("canvas");r.width=e.dw*i,r.height=e.dh*i;const n=r.getContext("2d");return n.scale(i,i),n.drawImage(t,e.sx,e.sy,e.sw,e.sh,e.dx,e.dy,e.dw,e.dh),r}function H(t,e){return new Promise((i,r)=>{const n={...U,...e},a=b(t);let d=y("video",{src:a,autoplay:!0}),h=!1;d.onerror=r,d.oncanplay=()=>{if(h)return;h=!0;const l=d.duration,v=typeof n.currentTime>"u"?l*Math.random():O(n.currentTime),u={url:a,videoFile:t,videoWidth:d.videoWidth,videoHeight:d.videoHeight,duration:l,currentTime:Math.min(v,l)};te(d,u).then(s=>{!n.width&&!n.height&&(n.width=u.videoWidth,n.height=u.videoHeight),T(s,e).then(o=>{i({videoInfo:u,...o}),d=null}).catch(r)}).catch(r)}})}function te(t,{currentTime:e,videoWidth:i,videoHeight:r}){return new Promise(n=>{t.currentTime=e,t.pause();const a="image/jpeg",d=y("canvas"),h=d.getContext("2d");d.width=i,d.height=r,setTimeout(()=>{h.drawImage(t,0,0,d.width,d.height),n(d.toDataURL(a))},500)})}function ie(t,e){return new Promise((i,r)=>{const n=t.type;/^(image|video)/.test(n)?RegExp.$1==="image"?T(t,e).then(i).catch(r):H(t,e).then(i).catch(r):r(new Error(`File type[${n}] not supported`))})}g.base64ToBlob=D,g.createBlobURL=b,g.createElement=y,g.fileToBase64=M,g.formatBytes=x,g.handleImageFile=T,g.handleMediaFile=ie,g.handleVideoFile=H,g.splitBase64=R,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
