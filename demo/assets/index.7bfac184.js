import{o as T,c as P,a as r,t as y,u as a,b as x,r as I,d as w,e as q,w as g,f as d,g as X,p as Y,h as ee,i as te,s as ie,j as M,k as $,l as N,m as S,n as le,q as se,v as ne,x as k,y as ae,F as W,z as oe,A as de}from"./vendor.38a690b4.js";const re=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(l){if(l.ep)return;l.ep=!0;const o=s(l);fetch(l.href,o)}};re();const ce="image-process",ue="4.2.0",he="Browser image processing and video screenshots (html5+canvas)",me="dist/image-process.umd.js",pe="dist/image-process.es.js",ge="types",_e=["image","crop","Video screenshot","Image Compression","html5","canvas"],fe=["dist","packages","types"],we="pnpm@7.5.1",ye={build:"cd packages/core && pnpm run build",preview:"vite preview",test:"vitest",coverage:"vitest run --coverage",docs:"node scripts/create-docs.js",lint:"eslint . --fix --ext .js,.cjs,.ts"},xe={"zx-sml":"^0.2.0"},be={"@types/jsdom":"^16.2.14","@types/node":"^17.0.42","@typescript-eslint/eslint-plugin":"^5.27.1","@typescript-eslint/parser":"^5.27.1",eslint:"^8.17.0","eslint-config-prettier":"^8.5.0","eslint-import-resolver-typescript":"^2.7.1","eslint-plugin-prettier":"^4.0.0",inquirer:"^8.2.4",jsdom:"^19.0.0",pnpm:"^7.5.1",prettier:"^2.6.2",typescript:"^4.7.3",vite:"^3.0.0",vitest:"^0.18.0"},ve="https://github.com/capricorncd/image-process-tools",Ve="Capricorncd <capricorncd@qq.com>",Te="MIT",Re={name:ce,version:ue,description:he,main:me,module:pe,types:ge,keywords:_e,files:fe,packageManager:we,scripts:ye,dependencies:xe,devDependencies:be,repository:ve,author:Ve,license:Te};const Pe=x(" image-process "),Ce=r("a",{href:"https://github.com/capricorncd/image-process-tools",target:"_blank"},[r("svg",{height:"24",class:"octicon octicon-mark-github",viewBox:"0 0 16 16",version:"1.1",width:"24","aria-hidden":"true"},[r("path",{"fill-rule":"evenodd",fill:"currentColor",d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"})])],-1),De={__name:"HeaderWrapper",setup(i){return(e,s)=>(T(),P("header",null,[r("h1",null,[Pe,r("span",null,"v "+y(a(Re).version),1)]),Ce]))}},C={mimeType:"image/jpeg",perResize:500,quality:.9,width:0,height:0,longestSide:1e3,enableDevicePixelRatio:!1,isForce:!1,cropInfo:{sx:0,sy:0,sw:0,sh:0},currentTime:0},u=I({form:JSON.parse(JSON.stringify(C)),result:null,file:null,setValue(i,e){this[i]=e}});const L=(i,e)=>{const s=i.__vccOpts||i;for(const[t,l]of e)s[t]=l;return s},b=i=>(Y("data-v-1e8229a7"),i=i(),ee(),i),$e=b(()=>r("label",{for:"fileInput",class:"el-button el-button--danger is-round"},"Choose File",-1)),Se={class:"file-name"},ze={class:"img-wrapper"},Fe={key:0,class:"info"},Ue=b(()=>r("dt",null,"Current",-1)),ke=b(()=>r("span",null,"width: ",-1)),Oe=b(()=>r("span",null,"height: ",-1)),Be=b(()=>r("span",null,"size: ",-1)),Ie=b(()=>r("span",null,"type: ",-1)),qe=b(()=>r("dt",null,"Raw",-1)),Me=b(()=>r("span",null,"width: ",-1)),Ne=b(()=>r("span",null,"height: ",-1)),We=b(()=>r("span",null,"size: ",-1)),Le=b(()=>r("span",null,"type: ",-1)),Ae=["src"],Ee={__name:"MainWrapper",setup(i){const e=s=>{const t=s.target.files[0];u.setValue("file",t)};return(s,t)=>{const l=w("el-form-item"),o=w("el-main");return T(),q(o,null,{default:g(()=>{var n;return[d(l,null,{default:g(()=>{var h;return[$e,r("input",{id:"fileInput",class:"file-input",type:"file",onChange:e},null,32),r("span",Se,y((h=a(u).file)==null?void 0:h.name),1)]}),_:1}),r("div",ze,[a(u).result?(T(),P("dl",Fe,[Ue,r("dd",null,[ke,x(y(a(u).result.width),1)]),r("dd",null,[Oe,x(y(a(u).result.height),1)]),r("dd",null,[Be,x(y(a(u).result.size.text),1)]),r("dd",null,[Ie,x(y(a(u).result.type),1)]),qe,r("dd",null,[Me,x(y(a(u).result.raw.width),1)]),r("dd",null,[Ne,x(y(a(u).result.raw.height),1)]),r("dd",null,[We,x(y(a(u).result.raw.size.text),1)]),r("dd",null,[Le,x(y(a(u).result.raw.type),1)])])):X("",!0),r("img",{src:(n=a(u).result)==null?void 0:n.url,alt:""},null,8,Ae)])]}),_:1})}}},He=L(Ee,[["__scopeId","data-v-1e8229a7"]]),A={enableDevicePixelRatio:!1,isForce:!1,mimeType:"image/jpeg",perResize:500,quality:.9,width:0,height:0,longestSide:0},je=/^data:(.+?);base64/,Je=/^image\/.+/;function E(i,e){return new Promise((s,t)=>{const l={...A,...e};typeof i=="string"&&je.test(i)?O(i,l,s,t):(i instanceof File||i instanceof Blob)&&Je.test(i.type)?te(i).then(o=>{O(o,l,s,t)}).catch(t):t(new Error(`Invalid file, ${i}`))})}function O(i,e,s,t){const{type:l}=ie(i),o=M(i,l),n=new Image;n.onload=()=>{const h={element:n,blob:o,data:i,url:$(o),width:n.naturalWidth||n.width,height:n.naturalHeight||n.height,type:l,size:N(o.size)};e.cropInfo&&e.cropInfo.sw&&e.cropInfo.sh?B(h,e,s,t,{...e.cropInfo,dx:0,dy:0,dw:e.cropInfo.sw,dh:e.cropInfo.sh}):e.width>0&&e.height>0?B(h,e,s,t,Ze(h,e)):e.width>0||e.height>0||e.longestSide>0?Ke(h,e,s,t):D({...h,raw:h},e,s)},n.onerror=t,n.src=i}function B(i,e,s,t,l){try{Object.prototype.hasOwnProperty.call(l,"enableDevicePixelRatio")||(l.enableDevicePixelRatio=e.enableDevicePixelRatio);const o=z(i.element,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:l.sx,sy:l.sy,sw:l.sw,sh:l.sh,dx:0,dy:0,dw:l.sw,dh:l.sh});!e.width&&!e.height?(e.width=l.sw,e.height=l.sh):e.width?e.height=l.sh*e.width/l.sw:e.width=l.sw*e.height/l.sh,H(o,i,e,{...l,sx:0,sy:0,sw:o.width,sh:o.height},s)}catch(o){t(o)}}function Ke(i,e,s,t){try{e.longestSide>0&&!e.width&&!e.height&&(i.width>=i.height?e.width=e.longestSide:e.height=e.longestSide);const l={enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:i.width,sh:i.height,dx:0,dy:0,dw:e.width,dh:e.height};if(e.width>0){if(i.width<e.width&&!e.isForce){D({...i,raw:i},e,s);return}l.dh=i.height*e.width/i.width,e.height=l.dh}else{if(i.height<e.height&&!e.isForce){D({...i,raw:i},e,s);return}l.dw=i.width*e.height/i.height,e.width=l.dw}H(i.element,i,e,l,s)}catch(l){t(l)}}function D(i,e,s){i.type!==e.mimeType?(i.type=e.mimeType,j(i.element,i.raw,e,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:i.width,sh:i.height,dx:0,dy:0,dw:i.width,dh:i.height},s)):s(i)}function H(i,e,s,t,l){let o=e.width>e.height?e.width-t.dw:e.height-t.dh;if(o>s.perResize){const n=e.height/e.width;for(;o>s.perResize;)o-=s.perResize,t.sw=i.width,t.sh=i.height,t.dw=s.width+o,t.dh=t.dw*n,i=z(i,t);t.sw=i.width,t.sh=i.height,t.dw=s.width,t.dh=s.height}j(i,e,s,t,l)}function j(i,e,s,t,l){const o=z(i,t),n=s.mimeType,h=o.toDataURL(n,s.quality),m=M(h,n);l({element:o,type:n,width:o.width,height:o.height,blob:m,data:h,url:$(m),size:N(m.size),raw:e})}function Ze(i,e){const{width:s,height:t}=i,{width:l,height:o}=e;let n;const h=t*l/o;if(s>h)n={sx:(s-h)/2,sy:0,sw:h,sh:t};else{const m=s*o/l;n={sx:0,sy:(t-m)/2,sw:s,sh:m}}return{...n,dx:0,dy:0,dw:l,dh:o}}function z(i,e){const s=e.enableDevicePixelRatio&&window.devicePixelRatio||1,t=S("canvas");t.width=e.dw*s,t.height=e.dh*s;const l=t.getContext("2d");return l.scale(s,s),l.drawImage(i,e.sx,e.sy,e.sw,e.sh,e.dx,e.dy,e.dw,e.dh),t}function Ge(i,e){return new Promise((s,t)=>{const l={...A,...e},o=$(i);let n=S("video",{src:o,autoplay:!0}),h=!1;n.onerror=t,n.oncanplay=()=>{if(h)return;h=!0;const m=n.duration,p=typeof l.currentTime>"u"?m*Math.random():le(l.currentTime),f={url:o,videoFile:i,videoWidth:n.videoWidth,videoHeight:n.videoHeight,duration:m,currentTime:Math.min(p,m)};Qe(n,f).then(_=>{!l.width&&!l.height&&(l.width=f.videoWidth,l.height=f.videoHeight),E(_,e).then(v=>{s({videoInfo:f,...v}),n=null}).catch(t)}).catch(t)}})}function Qe(i,{currentTime:e,videoWidth:s,videoHeight:t}){return new Promise(l=>{i.currentTime=e,i.pause();const o="image/jpeg",n=S("canvas"),h=n.getContext("2d");n.width=s,n.height=t,setTimeout(()=>{h.drawImage(i,0,0,n.width,n.height),l(n.toDataURL(o))},500)})}function Xe(i,e){return new Promise((s,t)=>{const l=i.type;/^(image|video)/.test(l)?RegExp.$1==="image"?E(i,e).then(s).catch(t):Ge(i,e).then(s).catch(t):t(new Error(`File type[${l}] not supported`))})}const Ye=x(" OK "),et=x(" Reset "),tt=se({__name:"AsideWrapper",setup(i){ne(()=>u.file,()=>{h()});const e=k(()=>{var m;return(m=u.result)!=null&&m.videoInfo?u.result.videoInfo.duration:0}),s=k(()=>{var v;const{width:m=0,height:p=0}=((v=u.result)==null?void 0:v.raw)||{},{sx:f,sy:_}=u.form.cropInfo;return{sx:m,sy:p,sw:m-f,sh:p-_}}),t=u.form,l=()=>{console.log("submit!"),t.mimeType=`${n.mimeTypePrefix}/${n.mimeTypeValue.replace(/\s/g,"")}`,h()},o=()=>{Object.keys(C).forEach(m=>{t[m]=C[m]}),n.mimeTypePrefix="image",n.mimeTypeValue="jpeg",h()},n=I({mimeTypePrefix:"image",mimeTypeValue:"jpeg"}),h=()=>{!u.file||Xe(u.file,t).then(m=>{console.log(m),u.setValue("result",m)}).catch(m=>{console.error(m)})};return(m,p)=>{const f=w("el-slider"),_=w("el-form-item"),v=w("el-button"),F=w("el-option"),K=w("el-select"),Z=w("el-input"),U=w("el-switch"),G=w("el-form"),Q=w("el-aside");return T(),q(Q,{width:"320px"},{default:g(()=>[d(G,{model:a(t),"label-position":"top"},{default:g(()=>[d(_,{label:`width: ${a(t).width}`},{default:g(()=>{var c,V;return[d(f,{modelValue:a(t).width,"onUpdate:modelValue":p[0]||(p[0]=R=>a(t).width=R),max:((V=(c=a(u).result)==null?void 0:c.raw)==null?void 0:V.width)||2e3,step:1},null,8,["modelValue","max"])]}),_:1},8,["label"]),d(_,{label:`height: ${a(t).height}`},{default:g(()=>{var c,V;return[d(f,{modelValue:a(t).height,"onUpdate:modelValue":p[1]||(p[1]=R=>a(t).height=R),max:((V=(c=a(u).result)==null?void 0:c.raw)==null?void 0:V.height)||2e3,step:1},null,8,["modelValue","max"])]}),_:1},8,["label"]),d(_,{label:`longestSide: ${a(t).longestSide}`},{default:g(()=>[d(f,{modelValue:a(t).longestSide,"onUpdate:modelValue":p[2]||(p[2]=c=>a(t).longestSide=c),max:a(u).result?Math.max(a(u).result.raw.width,a(u).result.raw.height):2e3,step:1},null,8,["modelValue","max"])]),_:1},8,["label"]),d(_,{label:"cropInfo"},{default:g(()=>[(T(!0),P(W,null,ae(Object.keys(a(t).cropInfo),(c,V)=>(T(),P("div",{key:V,class:"crop-info-item"},[r("span",null,y(`${c}: ${a(t).cropInfo[c]}`),1),d(f,{modelValue:a(t).cropInfo[c],"onUpdate:modelValue":R=>a(t).cropInfo[c]=R,max:a(s)[c],step:1},null,8,["modelValue","onUpdate:modelValue","max"])]))),128))]),_:1}),d(_,{class:"button-wrapper"},{default:g(()=>[d(v,{type:"primary",onClick:l},{default:g(()=>[Ye]),_:1}),d(v,{onClick:o},{default:g(()=>[et]),_:1})]),_:1}),d(_,{label:`Video currentTime: ${a(t).currentTime}`},{default:g(()=>[d(f,{modelValue:a(t).currentTime,"onUpdate:modelValue":p[3]||(p[3]=c=>a(t).currentTime=c),disabled:!a(e),max:a(e),step:.01},null,8,["modelValue","disabled","max","step"])]),_:1},8,["label"]),d(_,{label:"mimeType: Output picture mimeType"},{default:g(()=>[d(Z,{modelValue:n.mimeTypeValue,"onUpdate:modelValue":p[5]||(p[5]=c=>n.mimeTypeValue=c)},{prepend:g(()=>[d(K,{modelValue:n.mimeTypePrefix,"onUpdate:modelValue":p[4]||(p[4]=c=>n.mimeTypePrefix=c),placeholder:"Select",style:{width:"90px"}},{default:g(()=>[d(F,{label:"image",value:"image"}),d(F,{label:"video",value:"video"})]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),d(_,{label:`quality: ${a(t).quality}`},{default:g(()=>[d(f,{modelValue:a(t).quality,"onUpdate:modelValue":p[6]||(p[6]=c=>a(t).quality=c),max:1,step:.01},null,8,["modelValue","step"])]),_:1},8,["label"]),d(_,{label:`perResize: ${a(t).perResize}`},{default:g(()=>[d(f,{modelValue:a(t).perResize,"onUpdate:modelValue":p[7]||(p[7]=c=>a(t).perResize=c),min:10,max:1e3,step:10},null,8,["modelValue"])]),_:1},8,["label"]),d(_,{label:`enableDevicePixelRatio: ${a(t).enableDevicePixelRatio}`},{default:g(()=>[d(U,{modelValue:a(t).enableDevicePixelRatio,"onUpdate:modelValue":p[8]||(p[8]=c=>a(t).enableDevicePixelRatio=c)},null,8,["modelValue"])]),_:1},8,["label"]),d(_,{label:`isForce: ${a(t).isForce}`},{default:g(()=>[d(U,{modelValue:a(t).isForce,"onUpdate:modelValue":p[9]||(p[9]=c=>a(t).isForce=c)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1})}}});const it=L(tt,[["__scopeId","data-v-fbe88ffb"]]),lt={__name:"App",setup(i){return(e,s)=>{const t=w("el-container");return T(),P(W,null,[d(De),d(t,null,{default:g(()=>[d(He),d(it)]),_:1})],64)}}};const J=oe(lt);J.use(de);J.mount("#app");
