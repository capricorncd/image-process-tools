/*!
 * image-process version 4.2.0
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/image-process-tools
 * Released on: 2022-07-14 22:01:42 (GMT+0900)
 */
(function(f,w){typeof exports=="object"&&typeof module<"u"?w(exports):typeof define=="function"&&define.amd?define(["exports"],w):(f=typeof globalThis<"u"?globalThis:f||self,w(f.imageProcess={}))})(this,function(f){"use strict";/*!
 * zx-sml version 0.2.0
 * Author: Capricorncd <capricorncd@qq.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-07-13 22:46:38 (GMT+0900)
 */var w=Object.defineProperty,P=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable,T=(t,e,i)=>e in t?w(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,_=(t,e)=>{for(var i in e||(e={}))N.call(e,i)&&T(t,i,e[i]);if(P)for(var i of P(e))k.call(e,i)&&T(t,i,e[i]);return t};function W(t){return Array.isArray(t)}function v(t){return t!==null&&!W(t)&&typeof t=="object"}var V=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},y={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(t,e){(function(i,n){t.exports=n()})(typeof self<"u"?self:V,function(){return(()=>{var i={949:(r,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.toTwoDigits=void 0,a.toTwoDigits=function(o){return o[1]?o:"0"+o}},607:(r,a,o)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.toTwoDigits=a.toDate=a.formatDate=void 0;var d=o(949);Object.defineProperty(a,"toTwoDigits",{enumerable:!0,get:function(){return d.toTwoDigits}});var l={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function p(h){if(h instanceof Date)return h;if(typeof h=="number")return new Date(h);if(typeof h=="string"){var s=h.trim();if(/^\d+$/.test(s)){var c=s.length;return c===8?new Date([s.substr(0,4),s.substr(4,2),s.substr(6,2)].join("/")):c===6?new Date([s.substr(0,4),s.substr(4,2),"01"].join("/")):c===4?new Date(s+"/01/01"):new Date(parseInt(h))}if(s=s.replace(/[年月日]/g,function(u){return u==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(s))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(s))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var g=new Date(s);return isNaN(g.getFullYear())?null:g}return null}a.formatDate=function(h,s,c){var g,u=p(h);if(!u||!s)return h+"";if(s==="timestamp")return u.getTime().toString();/(y+)/i.test(s)&&(g=RegExp.$1,s=s.replace(g,(u.getFullYear()+"").substr(4-g.length))),c&&Array.isArray(c.weeks)||(c=l);var C={"M+":u.getMonth()+1,"d+":u.getDate(),"h+":u.getHours(),"m+":u.getMinutes(),"s+":u.getSeconds(),"w+":u.getDay(),"W+":c.weeks[u.getDay()],"a+":u.getHours()<12?"am":"pm","A+":u.getHours()<12?"AM":"PM"};for(var H in C)if(new RegExp("("+H+")").test(s)){g=RegExp.$1;var I=C[H]+"";s=s.replace(g,g.length===1?I:d.toTwoDigits(I))}if(/(g)/i.test(s)){var z=u.toString().split(/\s+/).slice(5),ne=s.includes("g");s=s.replace(/g/i,ne?z[0]:z.join(" "))}return s},a.toDate=p}},n={};return function r(a){if(n[a])return n[a].exports;var o=n[a]={exports:{}};return i[a](o,o.exports,r),o.exports}(607)})()})})(y);function E(t="",e="-"){return t.replace(/[A-Z]/g,(i,n)=>`${n>0?e:""}${i.toLowerCase()}`)}function Y(t="",e=!1){const i=t.replace(/[-_\s](\w)/g,(n,r)=>r.toUpperCase());return e?i.replace(/^\w/,n=>n.toUpperCase()):i}function Z(t){return t.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,e=>e.replace(/,/g,""))}function S(t,e=!1){if(typeof t=="number")return t;if(typeof t=="string"){if(!e&&/^(-?\d+(?:\.\d+)?)\D*/.test(Z(t)))return S(RegExp.$1,!0);const i=Number(t);return isNaN(i)?0:i}return 0}function O(t={},e=!1){const i=e?Y:E,n={};for(const[r,a]of Object.entries(t))n[i(r)]=v(a)?O(a,e):a;return n}function $(t,e=!1,i=2){const n=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],r=e?1e3:1024;let a=String(t),o="Byte";for(let d=0,l=t/r;l>1;l/=r,d++)a=l.toFixed(i),o=n[d];return e&&(o=o.replace("i","")),{text:a.replace(/\.0+$/,"")+o,value:+a,unit:o,bytes:t}}function m(t,e={},i){const n=document.createElement(t);for(const[r,a]of Object.entries(e))n.setAttribute(E(r),r==="style"&&v(a)?q(a):a);return i&&(typeof i=="string"?n.innerHTML=i:n.append(i)),n}function q(...t){const e=t.reduce((n,r)=>_(_({},n),O(r)),{}),i=[];for(const[n,r]of Object.entries(e))r===""||typeof r>"u"||r===null||i.push(`${n}:${r}`);return i.join(";")}function G(t){return new Promise((e,i)=>{const n=new FileReader;n.onload=r=>{var a;const o=(a=r.target)==null?void 0:a.result;o?e(o):i(new Error(`FileReader's result is null, ${r.target}`))},n.onerror=i,n.readAsDataURL(t)})}function x(t){return(window.URL||window.webkitURL).createObjectURL(t)}function F(t){const e=t.split(",");let i="";return/data:(\w+\/\w+);base64/.test(e[0])&&(i=RegExp.$1),{type:i,data:e[1]}}function M(t,e){const i=F(t),n=window.atob(i.data);e=e||i.type;const r=new Uint8Array(n.length);for(let a=0;a<n.length;a++)r[a]=n.charCodeAt(a);return new Blob([r],{type:e})}y.exports.formatDate,y.exports.toDate,y.exports.toTwoDigits;const B={enableDevicePixelRatio:!1,isForce:!1,mimeType:"image/jpeg",perResize:500,quality:.9,width:0,height:0,longestSide:0},K=/^data:(.+?);base64/,J=/^image\/.+/;function b(t,e){const i=e.enableDevicePixelRatio&&window.devicePixelRatio||1,n=m("canvas");n.width=e.dw*i,n.height=e.dh*i;const r=n.getContext("2d");return r.scale(i,i),r.drawImage(t,e.sx,e.sy,e.sw,e.sh,e.dx,e.dy,e.dw,e.dh),n}function R(t,e){return new Promise((i,n)=>{const r={...B,...e};typeof t=="string"&&K.test(t)?U(t,r,i,n):t instanceof File&&J.test(t.type)?G(t).then(a=>{U(a,r,i,n)}).catch(n):n(new Error(`Invalid file, ${t}`))})}function U(t,e,i,n){const{type:r}=F(t),a=M(t,r),o=new Image;o.onload=()=>{const d={element:o,blob:a,data:t,url:x(a),width:o.naturalWidth||o.width,height:o.naturalHeight||o.height,type:r,size:$(a.size)};e.width>0&&e.height>0?Q(d,e,i,n):e.width>0||e.height>0||e.longestSide>0?X(d,e,i,n):D({...d,raw:d},e,i)},o.onerror=n,o.src=t}function Q(t,e,i,n){try{const r=v(e.cropInfo)?{...e.cropInfo,dx:0,dy:0,dw:e.width,dh:e.height}:ee(t,e);Object.prototype.hasOwnProperty.call(r,"enableDevicePixelRatio")||(r.enableDevicePixelRatio=e.enableDevicePixelRatio);const a=b(t.element,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:r.sx,sy:r.sy,sw:r.sw,sh:r.sh,dx:0,dy:0,dw:r.sw,dh:r.sh});A(a,t,e,{...r,sx:0,sy:0,sw:a.width,sh:a.height},i)}catch(r){n(r)}}function X(t,e,i,n){try{e.longestSide>0&&!e.width&&!e.height&&(t.width>=t.height?e.width=e.longestSide:e.height=e.longestSide);const r={enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:t.width,sh:t.height,dx:0,dy:0,dw:e.width,dh:e.height};if(e.width>0){if(t.width<e.width&&!e.isForce){D({...t,raw:t},e,i);return}r.dh=t.height*e.width/t.width,e.height=r.dh}else{if(t.height<e.height&&!e.isForce){D({...t,raw:t},e,i);return}r.dw=t.width*e.height/t.height,e.width=r.dw}A(t.element,t,e,r,i)}catch(r){n(r)}}function D(t,e,i){t.type!==e.mimeType?(t.type=e.mimeType,j(t.element,t.raw,e,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:t.width,sh:t.height,dx:0,dy:0,dw:t.width,dh:t.height},i)):i(t)}function A(t,e,i,n,r){let a=e.width>e.height?e.width-n.dw:e.height-n.dh;if(a>i.perResize){const o=e.height/e.width;for(;a>i.perResize;)a-=i.perResize,n.sw=t.width,n.sh=t.height,n.dw=i.width+a,n.dh=n.dw*o,t=b(t,n);n.sw=t.width,n.sh=t.height,n.dw=i.width,n.dh=i.height}j(t,e,i,n,r)}function j(t,e,i,n,r){const a=b(t,n),o=i.mimeType,d=a.toDataURL(o,i.quality),l=M(d,o);r({element:a,type:o,width:a.width,height:a.height,blob:l,data:d,url:x(l),size:$(l.size),raw:e})}function ee(t,e){const{width:i,height:n}=t,{width:r,height:a}=e;let o;const d=n*r/a;if(i>d)o={sx:(i-d)/2,sy:0,sw:d,sh:n};else{const l=i*a/r;o={sx:0,sy:(n-l)/2,sw:i,sh:l}}return{...o,dx:0,dy:0,dw:r,dh:a}}function L(t,e){return new Promise((i,n)=>{const r={...B,...e},a=x(t);let o=m("video",{src:a,autoplay:!0}),d=!1;o.onerror=n,o.oncanplay=()=>{if(d)return;d=!0;const l=o.duration,p=typeof r.currentTime>"u"?l*Math.random():S(r.currentTime),h={videoFile:t,videoWidth:o.videoWidth,videoHeight:o.videoHeight,duration:l,currentTime:Math.min(p,l)};te(o,h).then(s=>{!r.width&&!r.height&&(r.width=h.videoWidth,r.height=h.videoHeight),R(s,e).then(c=>{i({videoInfo:h,...c}),o=null}).catch(n)}).catch(n)}})}function te(t,{currentTime:e,videoWidth:i,videoHeight:n}){return new Promise(r=>{t.currentTime=e,t.pause();const a="image/jpeg",o=m("canvas"),d=o.getContext("2d");o.width=i,o.height=n,setTimeout(()=>{d.drawImage(t,0,0,o.width,o.height),r(o.toDataURL(a))},500)})}function ie(t,e){return new Promise((i,n)=>{const r=t.type;/^(image|video)/.test(r)?RegExp.$1==="image"?R(t,e).then(i).catch(n):L(t,e).then(i).catch(n):n(new Error(`File type[${r}] not supported`))})}f.createElement=m,f.handleImageFile=R,f.handleMediaFile=ie,f.handleVideoFile=L,Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
