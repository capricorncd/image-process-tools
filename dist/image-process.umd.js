/*!
 * image-process version 4.3.1
 * Author: Xing Zhong <capricorncd@qq.com, zx198401@gmail.com>
 * Repository: https://github.com/capricorncd/image-process-tools
 * Released on: 2022-12-30 14:17:09 (GMT+0900)
 */
(function(c,o){typeof exports=="object"&&typeof module<"u"?o(exports):typeof define=="function"&&define.amd?define(["exports"],o):(c=typeof globalThis<"u"?globalThis:c||self,o(c.imageProcess={}))})(this,function(c){"use strict";/*!
 * zx-sml version 0.6.0
 * Author: Xing Zhong<zx198401@gmail.com>
 * Repository: https://github.com/capricorncd/zx-sml
 * Released on: 2022-09-09 21:21:26 (GMT+0900)
 */var o=Object.defineProperty,_=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable,B=(t,e,i)=>e in t?o(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,$=(t,e)=>{for(var i in e||(e={}))V.call(e,i)&&B(t,i,e[i]);if(_)for(var i of _(e))Y.call(e,i)&&B(t,i,e[i]);return t};function Z(t){return Array.isArray(t)}function O(t){return t!==null&&!Z(t)&&typeof t=="object"}var q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},m={exports:{}};/*! For license information please see date-utils-2020.js.LICENSE.txt */(function(t,e){(function(i,r){t.exports=r()})(typeof self<"u"?self:q,function(){return(()=>{var i={949:(n,a)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.toTwoDigits=void 0,a.toTwoDigits=function(d){return d[1]?d:"0"+d}},607:(n,a,d)=>{Object.defineProperty(a,"__esModule",{value:!0}),a.toTwoDigits=a.toDate=a.formatDate=void 0;var l=d(949);Object.defineProperty(a,"toTwoDigits",{enumerable:!0,get:function(){return l.toTwoDigits}});var s={weeks:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function v(u){if(u instanceof Date)return u;if(typeof u=="number")return new Date(u);if(typeof u=="string"){var h=u.trim();if(/^\d+$/.test(h)){var f=h.length;return f===8?new Date([h.substr(0,4),h.substr(4,2),h.substr(6,2)].join("/")):f===6?new Date([h.substr(0,4),h.substr(4,2),"01"].join("/")):f===4?new Date(h+"/01/01"):new Date(parseInt(u))}if(h=h.replace(/[年月日]/g,function(g){return g==="\u65E5"?"":"/"}).replace(/[(（（].*?[)））]/g," ").replace(/\bam|pm\b/gi," ").replace(/\s+/g," "),/^(\d{4})[-/](\d{1,2})[-/](\d{1,2})$/.test(h))return new Date([RegExp.$1,RegExp.$2,RegExp.$3].join("/"));if(/^(\d{4})[-/](\d{1,2})$/.test(h))return new Date([RegExp.$1,RegExp.$2,"01"].join("/"));var w=new Date(h);return isNaN(w.getFullYear())?null:w}return null}a.formatDate=function(u,h,f){var w,g=v(u);if(!g||!h)return u+"";if(h==="timestamp")return g.getTime().toString();/(y+)/i.test(h)&&(w=RegExp.$1,h=h.replace(w,(g.getFullYear()+"").substr(4-w.length))),f&&Array.isArray(f.weeks)||(f=s);var N={"M+":g.getMonth()+1,"d+":g.getDate(),"h+":g.getHours(),"m+":g.getMinutes(),"s+":g.getSeconds(),"w+":g.getDay(),"W+":f.weeks[g.getDay()],"a+":g.getHours()<12?"am":"pm","A+":g.getHours()<12?"AM":"PM"};for(var z in N)if(new RegExp("("+z+")").test(h)){w=RegExp.$1;var k=N[z]+"";h=h.replace(w,w.length===1?k:l.toTwoDigits(k))}if(/(g)/i.test(h)){var W=g.toString().split(/\s+/).slice(5),ne=h.includes("g");h=h.replace(/g/i,ne?W[0]:W.join(" "))}return h},a.toDate=v}},r={};return function n(a){if(r[a])return r[a].exports;var d=r[a]={exports:{}};return i[a](d,d.exports,n),d.exports}(607)})()})})(m);function F(t="",e="-"){return t.replace(/[A-Z]/g,(i,r)=>`${r>0?e:""}${i.toLowerCase()}`)}function G(t="",e=!1){const i=t.replace(/[-_\s](\w)/g,(r,n)=>n.toUpperCase());return e?i.replace(/^\w/,r=>r.toUpperCase()):i}function K(t){return t.replace(/^-?[1-9]\d{0,2}(,\d{3})+/,e=>e.replace(/,/g,""))}function M(t,e=!1){if(typeof t=="number")return t;if(typeof t=="string"){if(!e&&/^(-?\d+(?:\.\d+)?)\D*/.test(K(t)))return M(RegExp.$1,!0);const i=Number(t);return isNaN(i)?0:i}return 0}function S(t={},e=!1){const i=e?G:F,r={};for(const[n,a]of Object.entries(t))r[i(n)]=O(a)?S(a,e):a;return r}function x(t,e=!1,i=2){const r=["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],n=e?1e3:1024;let a=String(t),d="Byte";for(let l=0,s=t/n;s>1;s/=n,l++)a=s.toFixed(i),d=r[l];return e&&(d=d.replace("i","")),{text:a.replace(/\.0+$/,"")+d,value:+a,unit:d,bytes:t}}function y(t,e={},i){const r=document.createElement(t);for(const[n,a]of Object.entries(e))r.setAttribute(F(n),n==="style"&&O(a)?J(a):a);return i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{if(typeof n=="string"){const a=y("div");a.innerHTML=n,r.append(...a.childNodes)}else r.append(n)})),r}function J(...t){const e=t.reduce((r,n)=>$($({},r),S(n)),{}),i=[];for(const[r,n]of Object.entries(e))n===""||typeof n>"u"||n===null||i.push(`${r}:${n}`);return i.join(";")}function U(t){return new Promise((e,i)=>{const r=new FileReader;r.onload=n=>{var a;const d=(a=n.target)==null?void 0:a.result;d?e(d):i(new Error(`FileReader's result is null, ${n.target}`))},r.onerror=i,r.readAsDataURL(t)})}function b(t){return(window.URL||window.webkitURL).createObjectURL(t)}function R(t){const e=t.split(",");let i="";return/data:(\w+\/\w+);base64/.test(e[0])&&(i=RegExp.$1),{type:i,data:e[1]}}function D(t,e){const i=R(t),r=window.atob(i.data);e=e||i.type;const n=new Uint8Array(r.length);for(let a=0;a<r.length;a++)n[a]=r.charCodeAt(a);return new Blob([n],{type:e})}m.exports.formatDate,m.exports.toDate,m.exports.toTwoDigits;const A={enableDevicePixelRatio:!1,isForce:!1,mimeType:"image/jpeg",perResize:500,quality:.9,width:0,height:0,longEdge:0},Q=/^data:(.+?);base64/,X=/^image\/.+/;function T(t,e){return new Promise((i,r)=>{var a;const n={...A,...e,longEdge:(a=e==null?void 0:e.longEdge)!=null?a:e==null?void 0:e.longestSide};typeof t=="string"&&Q.test(t)?L(t,n,i,r):(t instanceof File||t instanceof Blob)&&X.test(t.type)?U(t).then(d=>{L(d,n,i,r)}).catch(r):r(new Error(`Invalid file, ${t}`))})}function L(t,e,i,r){const{type:n}=R(t),a=D(t,n),d=new Image;d.onload=()=>{const l={element:d,blob:a,data:t,url:b(a),width:d.naturalWidth||d.width,height:d.naturalHeight||d.height,type:n,size:x(a.size)};e.cropInfo&&e.cropInfo.sw&&e.cropInfo.sh?j(l,e,i,r,{...e.cropInfo,dx:0,dy:0,dw:e.cropInfo.sw,dh:e.cropInfo.sh}):e.width&&e.height?j(l,e,i,r,ee(l,e)):e.width||e.height||e.longEdge?I(l,e,i,r):P({...l,raw:l},e,i)},d.onerror=r,d.src=t}function j(t,e,i,r,n){try{Object.prototype.hasOwnProperty.call(n,"enableDevicePixelRatio")||(n.enableDevicePixelRatio=e.enableDevicePixelRatio);const a=E(t.element,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:n.sx,sy:n.sy,sw:n.sw,sh:n.sh,dx:0,dy:0,dw:n.sw,dh:n.sh});!e.width&&!e.height?e.longEdge?n.sw>n.sh?(e.width=e.longEdge,e.height=n.sh*e.width/n.sw):(e.height=e.longEdge,e.width=n.sw*e.height/n.sh):(e.width=n.sw,e.height=n.sh):e.width?e.height=n.sh*e.width/n.sw:e.width=n.sw*e.height/n.sh,p(a,t,e,{...n,sx:0,sy:0,sw:a.width,sh:a.height},i)}catch(a){r(a)}}function I(t,e,i,r){try{e.longEdge&&!e.width&&!e.height&&(t.width>=t.height?e.width=e.longEdge:e.height=e.longEdge);const n={enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:t.width,sh:t.height,dx:0,dy:0,dw:e.width,dh:e.height};if(e.width){if(t.width<e.width&&!e.isForce){P({...t,raw:t},e,i);return}n.dh=t.height*e.width/t.width,e.height=n.dh}else{if(t.height<e.height&&!e.isForce){P({...t,raw:t},e,i);return}n.dw=t.width*e.height/t.height,e.width=n.dw}p(t.element,t,e,n,i)}catch(n){r(n)}}function P(t,e,i){t.type!==e.mimeType?(t.type=e.mimeType,C(t.element,t.raw,e,{enableDevicePixelRatio:e.enableDevicePixelRatio,sx:0,sy:0,sw:t.width,sh:t.height,dx:0,dy:0,dw:t.width,dh:t.height},i)):i(t)}function p(t,e,i,r,n){let a=e.width>e.height?e.width-r.dw:e.height-r.dh;if(a>i.perResize){const d=e.height/e.width;for(;a>i.perResize;)a-=i.perResize,r.sw=t.width,r.sh=t.height,r.dw=i.width+a,r.dh=r.dw*d,t=E(t,r)}r.sw=t.width,r.sh=t.height,r.dw=i.width,r.dh=i.height,C(t,e,i,r,n)}function C(t,e,i,r,n){const a=E(t,r),d=/^\w+\/\*$/.test(i.mimeType)||!i.mimeType?e.type:i.mimeType,l=a.toDataURL(d,i.quality),s=D(l,d);n({element:a,type:d,width:a.width,height:a.height,blob:s,data:l,url:b(s),size:x(s.size),raw:e})}function ee(t,e){const{width:i,height:r}=t,{width:n,height:a}=e;let d;const l=r*n/a;if(i>l)d={sx:(i-l)/2,sy:0,sw:l,sh:r};else{const s=i*a/n;d={sx:0,sy:(r-s)/2,sw:i,sh:s}}return{...d,dx:0,dy:0,dw:n,dh:a}}function E(t,e){const i=e.enableDevicePixelRatio&&window.devicePixelRatio||1,r=y("canvas");r.width=e.dw*i,r.height=e.dh*i;const n=r.getContext("2d");return n.scale(i,i),n.drawImage(t,e.sx,e.sy,e.sw,e.sh,e.dx,e.dy,e.dw,e.dh),r}function H(t,e){return new Promise((i,r)=>{const n={...A,...e},a=b(t);let d=y("video",{src:a,autoplay:!0}),l=!1;d.onerror=r,d.oncanplay=()=>{if(l)return;l=!0;const s=d.duration,v=typeof n.currentTime>"u"?s*Math.random():M(n.currentTime),u={url:a,videoFile:t,videoWidth:d.videoWidth,videoHeight:d.videoHeight,duration:s,currentTime:Math.min(v,s)};te(d,u).then(h=>{!n.width&&!n.height&&(n.width=u.videoWidth,n.height=u.videoHeight),T(h,e).then(f=>{i({videoInfo:u,...f}),d=null}).catch(r)}).catch(r)}})}function te(t,{currentTime:e,videoWidth:i,videoHeight:r}){return new Promise(n=>{t.currentTime=e,t.pause();const a="image/jpeg",d=y("canvas"),l=d.getContext("2d");d.width=i,d.height=r,setTimeout(()=>{l.drawImage(t,0,0,d.width,d.height),n(d.toDataURL(a))},500)})}function ie(t,e){return new Promise((i,r)=>{const n=t.type;/^(image|video)/.test(n)?RegExp.$1==="image"?T(t,e).then(i).catch(r):H(t,e).then(i).catch(r):r(new Error(`File type[${n}] not supported`))})}c.base64ToBlob=D,c.createBlobURL=b,c.createElement=y,c.fileToBase64=U,c.formatBytes=x,c.handleImageFile=T,c.handleMediaFile=ie,c.handleVideoFile=H,c.splitBase64=R,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
